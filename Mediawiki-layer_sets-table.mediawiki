{| class="wikitable" style="float:right; margin-left:1em; width:300px;"
! colspan="2" | layer_sets table
|-
| '''Extension''' || [[Extension:Layers]]
|-
| '''Description''' || Stores layer set revisions. Each row represents a single revision of a named layer set for an image file.
|}

The '''layer_sets''' table stores layer set revisions for the [[Extension:Layers|Layers]] extension. Multiple revisions can exist per set name, enabling version history.

== Table Structure ==

{| class="wikitable"
! Column !! Type !! Nullable !! Default !! Description
|-
| <code>ls_id</code> || int unsigned || No || Auto-increment || Primary key, unique identifier for each revision
|-
| <code>ls_img_name</code> || varchar(255) binary || No || — || Target image filename (e.g., "Example.jpg")
|-
| <code>ls_img_major_mime</code> || varchar(16) || No || — || Major MIME type (e.g., "image")
|-
| <code>ls_img_minor_mime</code> || varchar(100) || No || — || Minor MIME type (e.g., "jpeg", "png")
|-
| <code>ls_img_sha1</code> || varchar(32) || No || — || SHA-1 hash of the image file (for versioning)
|-
| <code>ls_json_blob</code> || mediumblob || No || — || JSON-encoded layer data (validated, sanitized)
|-
| <code>ls_user_id</code> || int unsigned || Yes || NULL || User ID who created this revision
|-
| <code>ls_timestamp</code> || binary(14) || No || — || MediaWiki timestamp when revision was saved
|-
| <code>ls_revision</code> || int unsigned || No || 1 || Revision number within the named set (1, 2, 3...)
|-
| <code>ls_name</code> || varchar(255) || No || <code>default</code> || Named set identifier (e.g., "default", "anatomy-labels")
|-
| <code>ls_size</code> || int unsigned || No || 0 || Size of the JSON blob in bytes
|-
| <code>ls_layer_count</code> || smallint unsigned || No || 0 || Number of layers in this revision
|}

== Indexes ==

{| class="wikitable"
! Index Name !! Columns !! Type !! Purpose
|-
| PRIMARY || <code>ls_id</code> || Primary || Unique row identifier
|-
| <code>ls_img_name_set_revision</code> || <code>ls_img_name</code>, <code>ls_img_sha1</code>, <code>ls_name</code>, <code>ls_revision</code> || Unique || Ensures unique revisions per named set and image version
|-
| <code>ls_img_lookup</code> || <code>ls_img_name</code>, <code>ls_img_sha1</code> || Index || Fast lookup by image name and hash
|-
| <code>ls_user_timestamp</code> || <code>ls_user_id</code>, <code>ls_timestamp</code> || Index || Query sets by user with time ordering
|-
| <code>ls_timestamp</code> || <code>ls_timestamp</code> || Index || Query sets by date
|-
| <code>ls_size_performance</code> || <code>ls_size</code>, <code>ls_layer_count</code> || Index || Performance queries on size/count
|}

== Foreign Keys ==

No database-level foreign keys are declared. Per MediaWiki convention,
referential integrity is enforced at the application level.

== Data Format ==

The <code>ls_json_blob</code> column contains a JSON structure:

<syntaxhighlight lang="json">
{
  "revision": 1,
  "schema": 1,
  "created": "2026-01-03T12:00:00Z",
  "layers": [
    {
      "id": "layer-abc123",
      "type": "rectangle",
      "x": 100,
      "y": 50,
      "width": 200,
      "height": 100,
      "fill": "#ff0000",
      "stroke": "#000000",
      "strokeWidth": 2
    }
  ]
}
</syntaxhighlight>

== Revision Limits ==

* Maximum revisions per named set: configurable via <code>$wgLayersMaxRevisionsPerSet</code> (default: 50)
* Older revisions are automatically pruned when limit is exceeded
* Maximum named sets per image: configurable via <code>$wgLayersMaxNamedSets</code> (default: 15)

== Related Tables ==

* [[Extension:Layers/layer_assets table|layer_assets]] — Stores shared layer assets (images, patterns)
* [[Extension:Layers/layer_set_usage table|layer_set_usage]] — Tracks which articles use layer sets

== See Also ==

* [[Extension:Layers]] — Parent extension documentation
* [[Extension:Layers#Configuration]] — Configuration parameters
