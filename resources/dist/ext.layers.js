/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./resources/ext.layers/init.js":
/*!**************************************!*\
  !*** ./resources/ext.layers/init.js ***!
  \**************************************/
/***/ (() => {

eval("{function _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n// mw.layers bootstrap\n// Initializes viewers for annotated images and refreshes on content changes\nmw.layers = {\n  debug: false,\n  /**\n   * Log a debug message if debug mode is enabled.\n   * @param {...any} args Arguments to log.\n   */\n  debugLog: function debugLog() {\n    if (this.debug) {\n      var _console;\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      // eslint-disable-next-line no-console\n      (_console = console).log.apply(_console, ['[Layers]'].concat(args));\n    }\n  },\n  /**\n   * Log a warning message if debug mode is enabled.\n   * @param {...any} args Arguments to log.\n   */\n  debugWarn: function debugWarn() {\n    if (this.debug) {\n      var _console2;\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n      // eslint-disable-next-line no-console\n      (_console2 = console).warn.apply(_console2, ['[Layers]'].concat(args));\n    }\n  },\n  /** Initialize lightweight viewers and bind refresh on content changes */\n  init: function init() {\n    var self = this;\n    try {\n      this.debug = !!(typeof mw !== 'undefined' && mw.config && mw.config.get('wgLayersDebug'));\n    } catch (e) {}\n    this.debugLog('init() starting');\n    try {\n      this.debugLog('href:', String(window.location && window.location.href));\n    } catch (eHref) {/* ignore */}\n\n    // Initialize viewers for images annotated by server hooks\n    self.initializeLayerViewers();\n\n    // File page fallback if nothing found via attributes (gated to explicit layers=)\n    self.initializeFilePageFallback();\n\n    // If an image is marked layered but lacks inline data, fetch via API\n    self.initializeApiFallbackForMissingData();\n\n    // Re-scan when the page content changes (guard if mw.hook is unavailable)\n    try {\n      if (mw && mw.hook && typeof mw.hook === 'function') {\n        mw.hook('wikipage.content').add(function () {\n          self.initializeLayerViewers();\n          self.initializeFilePageFallback();\n          self.initializeApiFallbackForMissingData();\n        });\n      }\n    } catch (e) {/* ignore */}\n  },\n  /**\n   * Get the page-level layers parameter value if present.\n   * Returns the raw value (string) or null.\n   *\n   * @return {string|null}\n   */\n  getPageLayersParam: function getPageLayersParam() {\n    var pageLayersVal = null;\n    try {\n      // Prefer server-provided value if available\n      if (mw.config && typeof mw.config.get === 'function') {\n        var cfgVal = mw.config.get('wgLayersParam');\n        if (cfgVal) {\n          pageLayersVal = String(cfgVal);\n        }\n      }\n      if (!pageLayersVal && mw.util && typeof mw.util.getParamValue === 'function') {\n        pageLayersVal = mw.util.getParamValue('layers') || null;\n        if (!pageLayersVal) {\n          // Some setups might mistakenly capitalize the key\n          pageLayersVal = mw.util.getParamValue('Layers') || null;\n        }\n      }\n      var loc = String(window.location.href || '');\n      if (!pageLayersVal) {\n        try {\n          var u = new URL(loc);\n          pageLayersVal = u.searchParams.get('layers') || u.searchParams.get('Layers');\n          if (!pageLayersVal && u.hash) {\n            var mh = u.hash.match(/(?:^|[?&#;])layers=([^&#;]+)/i);\n            if (mh && mh[1]) {\n              pageLayersVal = decodeURIComponent(mh[1]);\n            }\n          }\n        } catch (eUrl) {/* ignore */}\n      }\n      if (!pageLayersVal) {\n        var mPage = loc.match(/[?&#;]layers=([^&#;]+)/i);\n        if (mPage && mPage[1]) {\n          pageLayersVal = decodeURIComponent(mPage[1]);\n        }\n      }\n    } catch (e) {/* ignore */}\n    if (pageLayersVal) {\n      this.debugLog('page-level layers param detected:', pageLayersVal);\n    }\n    return pageLayersVal;\n  },\n  /**\n   * Decode common HTML entities that may appear in data attributes\n   *\n   * @param {string} s\n   * @return {string}\n   */\n  decodeHtmlEntities: function decodeHtmlEntities(s) {\n    if (!s || typeof s !== 'string') {\n      return s;\n    }\n    // Quick replacements for most-common entities in our payload\n    var out = s.replace(/&amp;/g, '&');\n    out = out.replace(/&amp;quot;/g, '\"');\n    out = out.replace(/&quot;/g, '\"');\n    out = out.replace(/&#34;/g, '\"');\n    out = out.replace(/&#x22;/gi, '\"');\n    return out;\n  },\n  /**\n   * Determine whether a layers value denotes explicit enabling.\n   *\n   * @param {string} v\n   * @return {boolean}\n   */\n  isAllowedLayersValue: function isAllowedLayersValue(v) {\n    if (!v) {\n      return false;\n    }\n    var val = String(v).replace(/^\\s+|\\s+$/g, '').replace(/^['\"]|['\"]$/g, '').toLowerCase();\n    if (val === 'on' || val === 'all' || val === 'true' || val === '1' || val === 'yes') {\n      return true;\n    }\n    if (/^id:\\d+$/.test(val)) {\n      return true;\n    }\n    if (/^name:.+/.test(val)) {\n      return true;\n    }\n    if (/^(?:[0-9a-f]{2,8})(?:\\s*,\\s*[0-9a-f]{2,8})*$/i.test(val)) {\n      return true;\n    }\n    return false;\n  },\n  /**\n   * Escape a string for safe use within RegExp source.\n   *\n   * @param {string} s\n   * @return {string}\n   */\n  escRe: function escRe(s) {\n    return s.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n  },\n  /**\n   * Inspect nearest ancestor with data-mw JSON to detect a layers intent\n   * from original wikitext args. Returns a normalized string like\n   * 'on'|'all'|'off'|'none' or specific selectors (id:..., name:..., CSV).\n   *\n   * @param {HTMLElement} el An element within the output of a File node\n   * @return {string|null}\n   */\n  detectLayersFromDataMw: function detectLayersFromDataMw(el) {\n    var searchValue = function searchValue(dmwRoot) {\n      var foundLocal = null;\n      var _visit = function visit(v) {\n        if (foundLocal !== null || v === null) {\n          return;\n        }\n        var t = Object.prototype.toString.call(v);\n        if (t === '[object String]') {\n          var str = String(v);\n          var m2 = str.match(/(^|\\b)layers\\s*=\\s*([^,;\\]]+)/i);\n          if (m2) {\n            foundLocal = m2[2].trim().toLowerCase();\n          }\n          return;\n        }\n        if (t === '[object Array]') {\n          for (var j = 0; j < v.length; j++) {\n            _visit(v[j]);\n            if (foundLocal !== null) {\n              break;\n            }\n          }\n          return;\n        }\n        if (t === '[object Object]') {\n          if (typeof v.layers === 'string' && v.layers) {\n            foundLocal = v.layers.toLowerCase();\n            return;\n          }\n          if (typeof v.layer === 'string' && v.layer) {\n            foundLocal = v.layer.toLowerCase();\n            return;\n          }\n          for (var k in v) {\n            if (Object.prototype.hasOwnProperty.call(v, k)) {\n              _visit(v[k]);\n              if (foundLocal !== null) {\n                break;\n              }\n            }\n          }\n        }\n      };\n      _visit(dmwRoot);\n      return foundLocal;\n    };\n    try {\n      var node = el;\n      while (node && node.nodeType === 1) {\n        var raw = null;\n        if (node.getAttribute) {\n          raw = node.getAttribute('data-mw');\n        }\n        if (raw) {\n          try {\n            var decoded = this.decodeHtmlEntities(raw);\n            var dmw = JSON.parse(decoded);\n            if (dmw && _typeof(dmw) === 'object') {\n              var found = searchValue(dmw);\n              if (found) {\n                return found;\n              }\n            }\n          } catch (e2) {\n            // If JSON parse fails, attempt to extract layers=... via regex\n            try {\n              var layersRegex = /layers\\s*=\\s*([^,;\\]\\s\"']+)/i;\n              var rm = String(raw).match(layersRegex);\n              if (rm && rm[1]) {\n                return rm[1].trim().toLowerCase();\n              }\n            } catch (e2b) {/* ignore */}\n          }\n        }\n        node = node.parentNode;\n      }\n    } catch (e) {\n      // ignore\n    }\n    return null;\n  },\n  /**\n   * Find all images with server-provided layer data and overlay a canvas viewer.\n   */\n  initializeLayerViewers: function initializeLayerViewers() {\n    var _this = this;\n    var self = this;\n    // Primary: attributes directly on <img>\n    var images = Array.prototype.slice.call(document.querySelectorAll('img[data-layer-data]'));\n    // Ensure the marker class exists for any img we found\n    images.forEach(function (img) {\n      var cls = img.getAttribute('class') || '';\n      if (!cls.includes('layers-thumbnail')) {\n        img.setAttribute('class', (cls + ' layers-thumbnail').trim());\n      }\n    });\n    this.debugLog('Found', images.length, 'candidate <img> elements with data-layer-data');\n\n    // Fallback: attributes on wrapping <a>, move them to img for viewer\n    var anchors = Array.prototype.slice.call(document.querySelectorAll('a[data-layer-data] > img'));\n    anchors.forEach(function (img) {\n      if (img.hasAttribute('data-layer-data')) {\n        return;\n      }\n      var a = img.parentNode && img.parentNode.nodeType === 1 ? img.parentNode : null;\n      if (a && a.hasAttribute('data-layer-data')) {\n        img.setAttribute('data-layer-data', a.getAttribute('data-layer-data'));\n        var cls = img.getAttribute('class') || '';\n        if (!cls.includes('layers-thumbnail')) {\n          img.setAttribute('class', (cls + ' layers-thumbnail').trim());\n        }\n        images.push(img);\n        _this.debugLog('Moved data-layer-data from <a> to <img>');\n      }\n    });\n    images.forEach(function (img) {\n      if (img.layersViewer) {\n        return;\n      }\n      try {\n        var raw = img.getAttribute('data-layer-data');\n        if (!raw) {\n          return;\n        }\n        var layerData = null;\n        try {\n          layerData = JSON.parse(self.decodeHtmlEntities(raw));\n        } catch (eParse) {\n          layerData = null;\n        }\n        if (!layerData) {\n          return;\n        }\n        // Normalize payload to { layers: [...], baseWidth, baseHeight }\n        if (Array.isArray(layerData)) {\n          layerData = {\n            layers: layerData\n          };\n        }\n        var container = img.parentNode || img;\n        var style = window.getComputedStyle(container);\n        if (!style || style.position === 'static') {\n          var wrapper = document.createElement('span');\n          wrapper.style.position = 'relative';\n          wrapper.style.display = 'inline-block';\n          container.insertBefore(wrapper, img);\n          wrapper.appendChild(img);\n          container = wrapper;\n        }\n\n        // Instantiate viewer overlaying the image\n        img.layersViewer = new window.LayersViewer({\n          container: container,\n          imageElement: img,\n          layerData: layerData\n        });\n        var count = 0;\n        if (layerData.layers && layerData.layers.length) {\n          count = layerData.layers.length;\n        }\n        _this.debugLog('Viewer initialized with', count);\n        _this.debugLog('baseWidth=', layerData.baseWidth, 'baseHeight=', layerData.baseHeight);\n      } catch (e) {\n        // swallow to avoid breaking page rendering\n        _this.debugWarn('Viewer init error:', e);\n      }\n    });\n  },\n  /**\n   * Fallback: If an image is marked as a layers thumbnail but lacks data-layer-data,\n   * fetch the latest/specified layer set via API and initialize the viewer.\n   * This helps when server-side attribute injection was bypassed in a given render path.\n   */\n  initializeApiFallbackForMissingData: function initializeApiFallbackForMissingData() {\n    var _this2 = this;\n    try {\n      if (typeof mw === 'undefined' || !mw.loader || typeof mw.loader.using !== 'function') {\n        return;\n      }\n      // Ensure mediawiki.api is present before proceeding\n      mw.loader.using('mediawiki.api').then(function () {\n        // Detect page-level explicit layers intent (?layers=... in URL)\n        var pageAllow = false;\n        var pageLayersVal = mw.layers.getPageLayersParam();\n        if (pageLayersVal) {\n          pageAllow = mw.layers.isAllowedLayersValue(String(pageLayersVal).toLowerCase());\n        }\n\n        // Namespace awareness: treat page-level gating as sufficient only on File pages\n        var pageNsNum = -1;\n        try {\n          if (mw.config && mw.config.get) {\n            pageNsNum = mw.config.get('wgNamespaceNumber');\n          } else {\n            pageNsNum = -1;\n          }\n        } catch (eNsNum) {/* ignore */}\n\n        // Build candidate list (avoid duplicates)\n        var candidates = [];\n        var addAll = function addAll(selector) {\n          var list = document.querySelectorAll(selector);\n          Array.prototype.forEach.call(list, function (el) {\n            var idx = candidates.indexOf(el);\n            if (idx === -1) {\n              candidates.push(el);\n            }\n          });\n        };\n\n        // Images already marked as layered but missing inline data\n        addAll('img.layers-thumbnail:not([data-layer-data])');\n        // Images explicitly marked by server intent\n        addAll('img[data-layers-intent=\"on\"]:not([data-layer-data])');\n        // Images inside links that explicitly request layers=\n        addAll('a[href*=\"layers=\"] > img:not([data-layer-data])');\n        // Also include common content images; stricter gating below ensures\n        // we only act on per-image explicit layers intent\n        ['a.image > img:not([data-layer-data])', 'img.mw-file-element:not([data-layer-data])', 'img.thumbimage:not([data-layer-data])'].forEach(addAll);\n        // If page-level intent is present, add only images that link to File: pages.\n        // This keeps scope narrow versus selecting all content images.\n        if (pageAllow) {\n          ['a[href*=\"/File:\"] > img:not([data-layer-data])', 'a[href*=\"/wiki/File:\"] > img:not([data-layer-data])', 'a[href*=\"title=File:\"] > img:not([data-layer-data])', 'a[title^=\"File:\"] > img:not([data-layer-data])'].forEach(addAll);\n        }\n        _this2.debugLog('API fallback: pageAllow=', pageAllow, 'ns=', pageNsNum, 'candidates=', candidates.length);\n        if (!candidates.length) {\n          return;\n        }\n\n        // Localized File namespace name (default \"File\")\n        var fileNs = 'File';\n        try {\n          var nsMap = mw.config && mw.config.get ? mw.config.get('wgFormattedNamespaces') : null;\n          var name = nsMap && nsMap['6'] ? String(nsMap['6']) : null;\n          if (name) {\n            fileNs = name;\n          }\n        } catch (eNs) {/* ignore */}\n        var esc = function esc(s) {\n          return mw.layers.escRe(s);\n        };\n        var api = new mw.Api();\n\n        // Helper: try to extract filename from various attributes and URL patterns\n        var inferFilename = function inferFilename(imgEl, fileNamespace) {\n          var filename = null;\n          var a = imgEl.closest('a');\n          if (a && a.getAttribute('href')) {\n            var href = a.getAttribute('href');\n            try {\n              var decodedHref = href;\n              // Prefer query param title=<FileNs>:\n              var reTitle = new RegExp('[?&]title=' + esc(fileNamespace) + ':([^&#]+)', 'i');\n              var mTitle = decodedHref.match(reTitle);\n              if (mTitle && mTitle[1]) {\n                filename = decodeURIComponent(mTitle[1]).replace(/_/g, ' ');\n              } else {\n                // Path-style: /wiki/<FileNs>:... or /index.php/<FileNs>:...\n                var rePath = new RegExp('\\\\/(?:wiki\\\\/|index\\\\.php\\\\/)?' + esc(fileNamespace) + ':([^?#]+)', 'i');\n                var mPath = decodedHref.match(rePath);\n                if (mPath && mPath[1]) {\n                  filename = decodeURIComponent(mPath[1]).replace(/_/g, ' ');\n                }\n              }\n            } catch (e) {/* ignore */}\n          }\n\n          // Some skins put the title in the anchor title attribute\n          if (!filename && a && a.getAttribute('title')) {\n            var aTitle = a.getAttribute('title');\n            try {\n              var nsMap2 = mw.config && mw.config.get ? mw.config.get('wgFormattedNamespaces') : null;\n              var name2 = nsMap2 && nsMap2['6'] ? String(nsMap2['6']) : 'File';\n              var rePrefix = new RegExp('^' + esc(name2) + ':', 'i');\n              if (rePrefix.test(aTitle)) {\n                filename = aTitle.replace(rePrefix, '').replace(/_/g, ' ');\n              }\n            } catch (eT) {/* ignore */}\n          }\n\n          // Try common data attributes on the image or its parent containers\n          if (!filename) {\n            var dataFile = imgEl.getAttribute('data-file') || a && a.getAttribute('data-file');\n            if (dataFile) {\n              filename = String(dataFile).replace(/_/g, ' ');\n            }\n          }\n          if (!filename) {\n            var dataImageName = imgEl.getAttribute('data-image-name') || a && a.getAttribute('data-image-name');\n            if (dataImageName) {\n              filename = String(dataImageName).replace(/_/g, ' ');\n            }\n          }\n\n          // Parse from image src path (thumbnail/original)\n          if (!filename) {\n            var src = imgEl.getAttribute('src') || '';\n            try {\n              var rx = /\\/([-A-Za-z0-9%_. ]+?\\.(?:png|jpe?g|gif|svg|webp|tiff?))(?:[/?#]|$)/i;\n              var mSrc = src.match(rx);\n              if (mSrc && mSrc[1]) {\n                filename = decodeURIComponent(mSrc[1]).replace(/_/g, ' ');\n              }\n            } catch (eS) {/* ignore */}\n          }\n          return filename;\n        };\n        candidates.forEach(function (img) {\n          if (img.layersViewer) {\n            return;\n          }\n\n          // Early check: if image is explicitly marked as no-layers, skip it entirely\n          if (img.hasAttribute('data-layers-intent')) {\n            var intentEarly = (img.getAttribute('data-layers-intent') || '').toLowerCase();\n            if (intentEarly === 'none' || intentEarly === 'off') {\n              _this2.debugLog('Skipping image with explicit no-layers intent: ' + intentEarly);\n              return;\n            }\n          }\n          var filename = inferFilename(img, fileNs);\n          if (!filename) {\n            // As a last resort on file pages, fall back to wgPageName\n            try {\n              var curNsNum = mw.config.get('wgNamespaceNumber');\n              if (curNsNum === 6) {\n                var pageName = mw.config.get('wgPageName') || '';\n                var canonNs = mw.config.get('wgCanonicalNamespace') || 'File';\n                var prefix = canonNs + ':';\n                var hasPrefix = pageName.indexOf(prefix) === 0;\n                if (hasPrefix) {\n                  filename = pageName.slice(prefix.length).replace(/_/g, ' ');\n                } else {\n                  filename = null;\n                }\n              }\n            } catch (e2) {/* ignore */}\n          }\n          if (!filename) {\n            _this2.debugLog('API fallback skipped: no filename inferred for candidate');\n            _this2.debugLog('Attempted inference from href, title, data attributes, and src');\n            _this2.debugLog('Candidate image:', img);\n            var a = img.closest('a');\n            if (a) {\n              _this2.debugLog('Parent anchor href:', a.getAttribute('href'));\n              _this2.debugLog('Parent anchor title:', a.getAttribute('title'));\n            }\n            _this2.debugLog('Image src:', img.getAttribute('src'));\n            return;\n          }\n\n          // Gate: allow if per-image explicit intent is present.\n          // Treat page-level intent as sufficient ONLY on File pages (NS 6),\n          // or when the image clearly links to a File: page on non-File pages.\n          var allow = false;\n          var allowReason = '';\n          if (pageNsNum === 6) {\n            allow = pageAllow;\n            allowReason = 'File page with pageAllow=' + pageAllow;\n          }\n          var a2 = img.closest('a');\n          if (!allow && a2 && a2.getAttribute('href')) {\n            var href2 = a2.getAttribute('href');\n            var m = href2.match(/[?&#]layers=([^&#]+)/i);\n            if (m && m[1]) {\n              var val = decodeURIComponent(m[1]).toLowerCase();\n              allow = mw.layers.isAllowedLayersValue(val);\n              if (allow) {\n                allowReason = 'per-image layers parameter: ' + val;\n              }\n            }\n            // If page-level intent is present on a non-File page, and this image\n            // links to a File: page, allow it narrowly.\n            if (!allow && pageAllow && pageNsNum !== 6) {\n              try {\n                var filePrefixEsc = esc(fileNs) + ':';\n                var reTitleFile = new RegExp('[?&]title=' + filePrefixEsc, 'i');\n                var rePathFile = new RegExp('\\\\/(?:wiki\\\\/|index\\\\.php\\\\/)?' + filePrefixEsc, 'i');\n                var reMediaViewer = new RegExp('#\\\\/media\\\\/' + filePrefixEsc, 'i');\n                var reSpecialFilePath = /\\/(?:wiki\\/)?Special:(?:FilePath|Redirect\\/file)\\//i;\n                var isTitleMatch = reTitleFile.test(href2);\n                var isPathMatch = rePathFile.test(href2);\n                var isMediaViewer = reMediaViewer.test(href2);\n                var isSpecial = reSpecialFilePath.test(href2);\n                var isFileLink = isTitleMatch || isPathMatch || isMediaViewer || isSpecial;\n                // Many skins wrap file images with <a class=\"mw-file-description\">\n                // linking to the file page\n                if (!isFileLink) {\n                  var aCls2 = (a2.getAttribute('class') || '').toLowerCase();\n                  if (aCls2.includes('mw-file-description')) {\n                    isFileLink = true;\n                  }\n                }\n                if (isFileLink) {\n                  allow = true;\n                  allowReason = 'non-File page with pageAllow + file link detected';\n                }\n                if (!allow) {\n                  var aTitle2 = a2.getAttribute('title') || '';\n                  var reATitle = new RegExp('^' + filePrefixEsc, 'i');\n                  if (reATitle.test(aTitle2)) {\n                    allow = true;\n                    allowReason = 'non-File page with pageAllow + file title detected';\n                  }\n                }\n              } catch (eFileLink) {/* ignore */}\n            }\n\n            // As a narrow fallback: on non-File pages with pageAllow,\n            // if we infer a filename and the image appears to be a content image\n            if (!allow && pageAllow && pageNsNum !== 6) {\n              var cls = (img.getAttribute('class') || '') + ' ';\n              var looksContent = /(^|\\s)(mw-file-element|thumbimage)(\\s|$)/.test(cls);\n              var a3 = img.closest('a');\n              var aCls = a3 ? (a3.getAttribute('class') || '') + ' ' : '';\n              if (!looksContent && aCls) {\n                looksContent = /(^|\\s)(image|internal)(\\s|$)/i.test(aCls);\n              }\n              if (looksContent) {\n                allow = true;\n                allowReason = 'non-File page with pageAllow + content image class detected';\n              }\n            }\n          }\n          // Final gate: consult data-mw on ancestors to detect explicit\n          // wikitext layers= param\n          if (!allow) {\n            var mwLayers = mw.layers.detectLayersFromDataMw(img);\n            if (mwLayers) {\n              var v = String(mwLayers).toLowerCase();\n              allow = mw.layers.isAllowedLayersValue(v);\n              if (allow) {\n                allowReason = 'data-mw layers parameter: ' + v;\n              }\n            }\n          }\n          // If server marked explicit intent, allow\n          if (!allow && img.hasAttribute('data-layers-intent')) {\n            var intent = (img.getAttribute('data-layers-intent') || '').toLowerCase();\n            if (intent === 'none' || intent === 'off') {\n              // Explicitly marked as no-layers, skip regardless of page-level intent\n              _this2.debugLog('API fallback skipped: explicit no-layers intent');\n              _this2.debugLog('Reason: data-layers-intent=' + intent);\n              return;\n            }\n            if (mw.layers.isAllowedLayersValue(intent) || intent === 'on') {\n              allow = true;\n              allowReason = 'server-marked intent: ' + intent;\n            }\n          }\n          if (!allow) {\n            _this2.debugLog('API fallback skipped: not allowed for this candidate');\n            _this2.debugLog('Reason: pageAllow=' + pageAllow + ', pageNsNum=' + pageNsNum + ', filename=' + (filename || 'none') + ', allowReason=' + (allowReason || 'none'));\n            _this2.debugLog('Candidate image:', img);\n            return;\n          }\n          _this2.debugLog('API fallback proceeding for filename: ' + filename + ', reason: ' + allowReason);\n          api.get({\n            action: 'layersinfo',\n            format: 'json',\n            filename: filename\n          }).then(function (data) {\n            try {\n              if (!data || !data.layersinfo || !data.layersinfo.layerset) {\n                return;\n              }\n              var ls = data.layersinfo.layerset;\n              var layersArr = null;\n              if (ls && ls.data) {\n                if (Array.isArray(ls.data.layers)) {\n                  layersArr = ls.data.layers;\n                } else if (Array.isArray(ls.data)) {\n                  layersArr = ls.data;\n                }\n              }\n              if (!layersArr || !layersArr.length) {\n                return;\n              }\n              var baseW = ls.baseWidth || img.naturalWidth || img.width || null;\n              var baseH = ls.baseHeight || img.naturalHeight || img.height || null;\n              var payload = {\n                layers: layersArr,\n                baseWidth: baseW,\n                baseHeight: baseH\n              };\n\n              // Ensure a positioned container\n              var container = img.parentNode || img;\n              var style = window.getComputedStyle(container);\n              if (!style || style.position === 'static') {\n                var wrapper = document.createElement('span');\n                wrapper.style.position = 'relative';\n                wrapper.style.display = 'inline-block';\n                container.insertBefore(wrapper, img);\n                wrapper.appendChild(img);\n                container = wrapper;\n              }\n              img.layersViewer = new window.LayersViewer({\n                container: container,\n                imageElement: img,\n                layerData: payload\n              });\n              _this2.debugLog('API fallback initialized viewer for', filename);\n            } catch (e2) {\n              _this2.debugWarn('API fallback error:', e2);\n            }\n          });\n        });\n      }); // end mw.loader.using('mediawiki.api')\n    } catch (e) {/* ignore */}\n  },\n  /**\n   * On File pages, initialize the main image by fetching layer data via API\n   * if server-side attributes are missing.\n   *\n   * @param {boolean} debug Enable debug logging\n   */\n  initializeFilePageFallback: function initializeFilePageFallback(debug) {\n    try {\n      if (typeof mw === 'undefined') {\n        return;\n      }\n      var ns = mw.config.get('wgNamespaceNumber');\n      if (ns !== 6) {\n        return; // NS_FILE only\n      }\n\n      // Require explicit layers= in URL (on|all or list). Prevent implicit overlays.\n      var pageLayersVal = mw.layers.getPageLayersParam(debug);\n      var hasLayersParam = !!pageLayersVal;\n      if (!hasLayersParam) {\n        if (debug) {\n          console.info('[Layers] Skipping file page fallback: no layers= in URL');\n        }\n        return;\n      }\n\n      // Find the main file image on the file description page\n      var selector = '#file img, .fullMedia a > img, .mw-filepage-content img';\n      var img = document.querySelector(selector);\n      if (!img || img.layersViewer) {\n        return;\n      }\n      if (img.getAttribute('data-layer-data')) {\n        return;\n      }\n      var pageName = mw.config.get('wgPageName') || '';\n      var canonNs = mw.config.get('wgCanonicalNamespace') || 'File';\n      var prefix = canonNs + ':';\n      var filename;\n      if (pageName.indexOf(prefix) === 0) {\n        filename = pageName.slice(prefix.length);\n      } else {\n        filename = pageName;\n      }\n      try {\n        filename = decodeURIComponent(filename);\n      } catch (e) {}\n      filename = filename.replace(/_/g, ' ');\n      var api = new mw.Api();\n      api.get({\n        action: 'layersinfo',\n        format: 'json',\n        filename: filename\n      }).then(function (data) {\n        try {\n          if (!data || !data.layersinfo || !data.layersinfo.layerset) {\n            return;\n          }\n          var layerset = data.layersinfo.layerset;\n          var payload = null;\n          if (layerset && layerset.data && (layerset.data.layers || layerset.data)) {\n            var layersArr;\n            var arrTag = Object.prototype.toString.call(layerset.data.layers);\n            if (layerset.data.layers && arrTag === '[object Array]') {\n              layersArr = layerset.data.layers;\n            } else {\n              layersArr = layerset.data;\n            }\n            if (layersArr && layersArr.length) {\n              var bw = layerset.baseWidth || img.naturalWidth || img.width || null;\n              var bh = layerset.baseHeight || img.naturalHeight || img.height || null;\n              payload = {\n                layers: layersArr,\n                baseWidth: bw,\n                baseHeight: bh\n              };\n            }\n          }\n          if (!payload) {\n            return;\n          }\n\n          // Ensure container is positioned\n          var container = img.parentNode || img;\n          var style = window.getComputedStyle(container);\n          if (!style || style.position === 'static') {\n            var wrapper = document.createElement('span');\n            wrapper.style.position = 'relative';\n            wrapper.style.display = 'inline-block';\n            container.insertBefore(wrapper, img);\n            wrapper.appendChild(img);\n            container = wrapper;\n          }\n          img.layersViewer = new window.LayersViewer({\n            container: container,\n            imageElement: img,\n            layerData: payload\n          });\n          if (debug) {\n            var count2 = 0;\n            if (payload.layers && payload.layers.length) {\n              count2 = payload.layers.length;\n            }\n            console.info('[Layers] File page fallback initialized with', count2, 'layers');\n          }\n        } catch (e2) {\n          if (debug) {\n            console.warn('[Layers] File page fallback error:', e2);\n          }\n        }\n      })[\"catch\"](function () {/* ignore */});\n    } catch (e) {\n      if (debug) {\n        console.warn('[Layers] File page fallback outer error:', e);\n      }\n    }\n  }\n};\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', function () {\n    mw.layers.init();\n  });\n} else {\n  mw.layers.init();\n}\n\n//# sourceURL=webpack://Layers/./resources/ext.layers/init.js?\n}");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./resources/ext.layers/init.js"]();
/******/ 	window["Layersext.layers"] = __webpack_exports__;
/******/ 	
/******/ })()
;