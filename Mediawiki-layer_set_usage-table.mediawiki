{| class="wikitable" style="float:right; margin-left:1em; width:300px;"
! colspan="2" | layer_set_usage table
|-
| '''Extension''' || [[Extension:Layers]]
|-
| '''Description''' || Tracks which wiki articles embed images with layer sets.
|}

The '''layer_set_usage''' table tracks article usage for the [[Extension:Layers|Layers]] extension. This enables cache invalidation when layer data changes and provides usage statistics.

== Table Structure ==

{| class="wikitable"
! Column !! Type !! Nullable !! Default !! Description
|-
| <code>lsu_layer_set_id</code> || int unsigned || No || — || Layer set ID (foreign key to layer_sets.ls_id)
|-
| <code>lsu_page_id</code> || int unsigned || No || — || Page ID of the article using the layered image (foreign key to page.page_id)
|-
| <code>lsu_timestamp</code> || binary(14) || No || — || When the usage was recorded
|-
| <code>lsu_usage_count</code> || int unsigned || No || 1 || Number of times this layer set is used on the page
|}

== Indexes ==

{| class="wikitable"
! Index Name !! Columns !! Type !! Purpose
|-
| PRIMARY || <code>lsu_layer_set_id</code>, <code>lsu_page_id</code> || Composite Primary || Unique per layer set + page combination
|-
| <code>lsu_page_id</code> || <code>lsu_page_id</code> || Index || Find all layer sets used on a specific page
|-
| <code>lsu_timestamp</code> || <code>lsu_timestamp</code> || Index || Query usages by date
|-
| <code>lsu_usage_count</code> || <code>lsu_usage_count</code> || Index || Find frequently used layer sets
|}

== Foreign Keys ==

{| class="wikitable"
! Column !! References !! On Delete
|-
| <code>lsu_layer_set_id</code> || <code>layer_sets.ls_id</code> || CASCADE
|-
| <code>lsu_page_id</code> || <code>page.page_id</code> || CASCADE
|}

== Usage ==

This table is populated automatically when:
* An article is parsed that contains <code><nowiki>[[File:Example.jpg|layerset=setname]]</nowiki></code>
* The parser hook <code>ParserMakeImageParams</code> detects the <code>layerset</code> parameter

The table enables:
* '''Cache invalidation''': When layer data changes, all pages using that layer set can be purged
* '''Usage statistics''': Track which images have active layer annotations
* '''Orphan detection''': Find layer sets that are no longer used by any article
* '''Usage counting''': Track how many times each layer set is embedded per page

== Cleanup ==

Entries are automatically removed when:
* A page is deleted
* An image is deleted (via <code>FileDeleteComplete</code> hook)
* The <code>layers</code> parameter is removed from a page during re-parse

== Related Tables ==

* [[Extension:Layers/layer_sets table|layer_sets]] — Stores the actual layer data
* [[Extension:Layers/layer_assets table|layer_assets]] — Stores shared layer assets

== See Also ==

* [[Extension:Layers]] — Parent extension documentation
