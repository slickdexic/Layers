{{Extension
|image           = ExtensionLayersEditor.png
|name            = Layers
|status          = stable
|type1           = media
|type2           = interface
|type3           = api
|author          = [[User:Pvodrazka|Pvodrazka]]
|version         = 1.2.17
|update          = 2025-12-30
|download        = {{GithubDownload|slickdexic|Layers}}
|readme          = [https://github.com/slickdexic/Layers/blob/main/README.md README]
|changelog       = [https://github.com/slickdexic/Layers/blob/main/CHANGELOG.md CHANGELOG]
|license         = GPL-2.0-or-later
|tags            = {{bulleted list|<annotation>|<canvas>|<drawing>|<image editor>|<image markup>|<non-destructive>}}
|mediawiki       = >= 1.44
|php             = >= 8.1
|needs-updatephp = yes
|rights          = {{bulleted list|createlayers|editlayers|managelayerlibrary}}
|parameters      = {{bulleted list|$wgLayersMaxBytes|$wgLayersMaxImageBytes|$wgLayersMaxLayerCount|$wgLayersMaxNamedSets|$wgLayersMaxRevisionsPerSet}}
|hook1           = BeforePageDisplay
|hook2           = BitmapHandlerTransform
|hook3           = FileDeleteComplete
|hook4           = ImageBeforeProduceHTML
|hook5           = LinkerMakeMediaLinkFile
|hook6           = LoadExtensionSchemaUpdates
|hook7           = MakeGlobalVariablesScript
|hook8           = ParserBeforeInternalParse
|hook9           = ParserFirstCallInit
|hook10          = ParserMakeImageParams
|hook11          = SkinTemplateNavigation::Universal
|hook12          = ThumbnailBeforeProduceHTML
|description     = A professional-grade, non-destructive image annotation system with 14 drawing tools, layer folders, style presets, named layer sets, and full keyboard accessibility.
}}

The '''Layers''' extension is a modern, non-destructive image annotation and editing tool for MediaWiki. It enables users to add captions, callouts, highlights, shapes, and freehand drawings to images '''without altering the original file'''.

All edits are stored as validated JSON and rendered client-side for precise positioning. The system fully integrates into MediaWiki's file pages and parser. Click the {{key press|'''Edit Layers'''}} tab on any image's <code>File:</code> page to access the editor.

== Why Layers? ==
* '''Professional Tools:''' 12 drawing tools, style presets, and industry-standard alignmentâ€”everything needed to annotate like a pro.
* '''Non-Destructive:''' Original images are never modified. Annotations are stored separately and can be versioned or removed at any time.
* '''Accessible:''' WCAG 2.1 compliant with full keyboard navigation, screen reader support, and high-contrast indicators.

== Key Features ==

=== Key Object Alignment (v1.1.6+) ===
Industry-standard alignment behavior matching Adobe Illustrator and Photoshop:
* When multiple layers are selected, the '''last selected layer''' becomes the "key object".
* Other layers align '''TO''' the key object, which stays fixed in place.
* Key object is visually distinguished with an '''orange border''' (others have blue).
* Works for all alignment operations: left, center, right, top, middle, bottom.

=== Core Features ===
* '''Layer Grouping (v1.2.13+)''': Group layers into folders for bulk operations ({{key press|Ctrl}}+{{key press|G}} to group, {{key press|Ctrl}}+{{key press|Shift}}+{{key press|G}} to ungroup).
* '''Named Layer Sets''': Multiple annotation sets per image (e.g., "default", "anatomy-labels").
* '''Style Presets''': Save and reuse style configurations per tool type.
* '''Revision History''': Automatically tracks up to 50 revisions per layer set.
* '''Import/Export''': Add external images as layers or export the final result as a PNG.
* '''TypeScript Support''': Full type definitions for extension developers.

== Drawing Tools ==
{| class="wikitable"
! Tool !! Shortcut !! Purpose !! Key Features
|-
| Pointer || {{key press|V}} || Select/manipulate || Multi-select, resize, rotate, Key Object alignment
|-
| Text || {{key press|T}} || Simple Text || Click to place, inline editing
|-
| Text Box || {{key press|X}} || Advanced Text || Word wrap, alignment, padding, corner radius
|-
| Pen || {{key press|P}} || Freehand || Smooth paths, adjustable stroke
|-
| Rectangle || {{key press|R}} || Basic Shape || Adjustable stroke, fill, corner radius
|-
| Circle || {{key press|C}} || Basic Shape || Perfect circles with stroke and fill
|-
| Ellipse || {{key press|E}} || Basic Shape || Oval shapes with independent radii
|-
| Polygon || {{key press|Y}} || Complex Shape || Configurable sides, rounded corners
|-
| Star || {{key press|S}} || Complex Shape || Configurable points and radii
|-
| Arrow || {{key press|A}} || Annotations || Configurable head types and line styles
|-
| Line || {{key press|L}} || Annotations || Simple lines with adjustable stroke
|-
| Blur || {{key press|B}} || Privacy/Focus || Non-destructive background blurring
|}

== Configuration ==
=== Parameters ===
{| class="wikitable"
! Variable !! Type !! Default !! Description
|-
| <code>$wgLayersMaxLayerCount</code> || integer || <code>100</code> || Max layers per set.
|-
| <code>$wgLayersMaxNamedSets</code> || integer || <code>15</code> || Max named sets per image.
|-
| <code>$wgLayersMaxRevisionsPerSet</code> || integer || <code>50</code> || Historical revisions to keep.
|-
| <code>$wgLayersMaxImageBytes</code> || integer || <code>1048576</code> || Max size for imported image layers.
|-
| <code>$wgLayersMaxBytes</code> || integer || <code>2097152</code> || Max JSON size for a single layer set.
|}

=== Permissions ===
{| class="wikitable"
! Right !! Description !! Default Groups
|-
| <code>editlayers</code> || Edit existing layer sets || <code>user</code>
|-
| <code>createlayers</code> || Create new layer sets || <code>autoconfirmed</code>
|-
| <code>managelayerlibrary</code> || Manage global layer library || <code>sysop</code>
|}

== Installation ==
# Clone the repository into your <code>extensions/</code> directory.
# Run <code>composer install</code> and <code>npm install</code> within the folder.
# Add <code>wfLoadExtension( 'Layers' );</code> to <code>LocalSettings.php</code>.
# Run <code>php maintenance/run.php update.php</code>.

== Technical Details ==
* '''Performance:''' Architecture splits the lightweight Viewer (~2,800 lines) from the Editor (~43k lines).
* '''Stability:''' 7,658 Jest tests across 135 test suites achieving 94% statement coverage.
* '''Security:''' Property whitelisting (50+ fields), CSRF protection, and strict text sanitization.

== See also ==
* [https://github.com/slickdexic/Layers/blob/main/CHANGELOG.md Full Changelog]
* [https://github.com/slickdexic/Layers/wiki Project Wiki]

[[Category:Image extensions]]
[[Category:User interface extensions]]
[[Category:API extensions]]
[[Category:Stable extensions]]