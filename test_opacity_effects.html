<!DOCTYPE html>
<html>
<head>
    <title>Test Opacity and Effects Save/Load</title>
    <style>
        body { margin: 20px; font-family: Arial; }
        .test-container { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        .layer-info { background: #f5f5f5; padding: 10px; margin: 10px 0; }
        button { margin: 5px; padding: 8px 16px; }
    </style>
</head>
<body>
    <h1>Test Opacity and Effects Save/Load</h1>

    <div class="test-container">
        <h2>Test Layer Data</h2>
        <button onclick="createTestLayer()">Create Test Layer</button>
        <button onclick="testSerialization()">Test Serialization</button>
        <button onclick="testOpacityValues()">Test Opacity Values</button>
        
        <div id="results"></div>
    </div>

    <script>
        function createTestLayer() {
            const testLayer = {
                id: 'test_layer_1',
                type: 'rectangle',
                x: 50,
                y: 50,
                width: 100,
                height: 100,
                fill: '#ff0000',
                stroke: '#000000',
                strokeWidth: 2,
                // Test opacity values
                opacity: 0.8,
                fillOpacity: 0.6,
                strokeOpacity: 0.4,
                // Test effects
                shadow: true,
                shadowColor: '#000000',
                shadowBlur: 8,
                shadowOffsetX: 2,
                shadowOffsetY: 2,
                shadowSpread: 0,
                glow: false,
                // Text specific effects
                textShadow: true,
                textStrokeWidth: 1,
                textStrokeColor: '#ffffff'
            };

            document.getElementById('results').innerHTML = 
                '<div class="layer-info"><strong>Test Layer Created:</strong><pre>' + 
                JSON.stringify(testLayer, null, 2) + '</pre></div>';
            
            return testLayer;
        }

        function testSerialization() {
            const testLayer = createTestLayer();
            const serialized = JSON.stringify([testLayer]);
            const deserialized = JSON.parse(serialized);
            
            const results = document.getElementById('results');
            results.innerHTML += 
                '<div class="layer-info"><strong>Serialized:</strong><pre>' + serialized + '</pre></div>' +
                '<div class="layer-info"><strong>Deserialized:</strong><pre>' + JSON.stringify(deserialized, null, 2) + '</pre></div>';
            
            // Check if all properties survived serialization
            const original = testLayer;
            const restored = deserialized[0];
            
            const missingProps = [];
            const changedProps = [];
            
            for (const prop in original) {
                if (!(prop in restored)) {
                    missingProps.push(prop);
                } else if (original[prop] !== restored[prop]) {
                    changedProps.push(`${prop}: ${original[prop]} -> ${restored[prop]}`);
                }
            }
            
            let status = '<div class="layer-info">';
            if (missingProps.length === 0 && changedProps.length === 0) {
                status += '<strong style="color: green;">✓ All properties preserved in serialization</strong>';
            } else {
                if (missingProps.length > 0) {
                    status += '<strong style="color: red;">✗ Missing properties:</strong> ' + missingProps.join(', ') + '<br>';
                }
                if (changedProps.length > 0) {
                    status += '<strong style="color: orange;">⚠ Changed properties:</strong><br>' + changedProps.join('<br>');
                }
            }
            status += '</div>';
            
            results.innerHTML += status;
        }

        function testOpacityValues() {
            const opacityTests = [
                { value: 0, expected: 0 },
                { value: 0.5, expected: 0.5 },
                { value: 1, expected: 1 },
                { value: undefined, expected: undefined },
                { value: null, expected: null },
                { value: '0.5', expected: '0.5' },
                { value: '', expected: '' }
            ];
            
            let results = '<div class="layer-info"><strong>Opacity Value Tests:</strong><br>';
            
            opacityTests.forEach((test, index) => {
                const layer = { 
                    opacity: test.value,
                    fillOpacity: test.value,
                    strokeOpacity: test.value
                };
                
                const serialized = JSON.stringify(layer);
                const deserialized = JSON.parse(serialized);
                
                const opacityMatch = deserialized.opacity === test.expected;
                const fillOpacityMatch = deserialized.fillOpacity === test.expected;
                const strokeOpacityMatch = deserialized.strokeOpacity === test.expected;
                
                const status = (opacityMatch && fillOpacityMatch && strokeOpacityMatch) ? '✓' : '✗';
                results += `${status} Test ${index + 1}: ${test.value} -> ${JSON.stringify(deserialized)}<br>`;
            });
            
            results += '</div>';
            document.getElementById('results').innerHTML += results;
        }
    </script>
</body>
</html>
